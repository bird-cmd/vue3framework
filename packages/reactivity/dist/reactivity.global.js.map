{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export {effect} from './effect';\r\nexport {reactive} from './reactive'\r\n", "export let activeEffect =undefined;\r\nfunction cleanupEffect(effect){\r\n    const {deps} = effect;\r\n    for(let i =0;i<deps.length; i++){\r\n        deps[i].delete(effect);\r\n    }\r\n    effect.deps.length =0;\r\n}\r\nclass ReactiveEffect{\r\n    public deps = [];\r\n    public parent = null;\r\n    public active =true;\r\n    constructor(public fn){};\r\n    run(){\r\n        if(!this.active){\r\n            this.fn()\r\n        }\r\n        try{\r\n            this.parent = activeEffect;\r\n            activeEffect = this;\r\n            cleanupEffect(this);\r\n            return this.fn();\r\n        }finally{\r\n            activeEffect = this.parent;\r\n        }\r\n    }\r\n    stop(){\r\n        if(this.active){\r\n            this.active = false;\r\n            cleanupEffect(this);\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport function effect(fn){\r\n//\u8FD9\u91CCfn\u53EF\u4EE5\u6839\u636E\u72B6\u6001\u53D8\u5316\u6267\u884C\uFF0C\u4E5F\u53EF\u4EE5\u5D4C\u5957\u6267\u884C\r\n  const _effect=  new ReactiveEffect(fn);\r\n  _effect.run();\r\n  const runner =_effect.run.bind(_effect);\r\n  runner.effect = _effect;\r\n  return runner;\r\n}\r\n// \u4F9D\u8D56\u6536\u96C6\r\nconst targetMap = new WeakMap();\r\nexport function track(target ,type,key){\r\nif(!activeEffect) return;\r\nlet depsMap =targetMap.get(target);\r\nif(!depsMap){\r\n    targetMap.set(target,depsMap=new Map())\r\n};\r\nlet dep =depsMap.get(key);\r\nif(!dep){\r\n    depsMap.set(key,dep = new Set());\r\n}\r\nlet shouldTrack = dep.has(activeEffect);\r\nif(!shouldTrack){\r\n    dep.add(activeEffect);\r\n    activeEffect.deps.push(dep); //\u505A\u6E05\u7406\u7684\u65F6\u5019\u4F1A\u7528\u5230\r\n    //\u591A\u5BF9\u591A\r\n}\r\n}\r\nexport function trigger(target,type,key,value,oldvalue){\r\n    const depsMap =targetMap.get(target);\r\n    if(!depsMap) return;\r\n    let effects = depsMap.get(key);\r\n    if(effects){\r\n        effects = new Set(effects);\r\n        effects.forEach(effect => {\r\n            if(effect !== activeEffect){\r\n                effect.run();\r\n            }\r\n        });\r\n    }\r\n   \r\n}", "export const isObject = (value)=>{\r\n    return typeof value==='object'&& value!==null;\r\n}", "// import { activeEffect } from \"./effect\";\r\nimport { track ,trigger} from \"./effect\";\r\nexport const enum ReactiveFlags{\r\n    IS_REACTIVE = '_v_isReactive'\r\n}\r\nexport const mutableHandler = \r\n    {\r\n        get(target, key ,receiver){\r\n            // debugger\r\n            // activeEffect;\r\n            if(key === ReactiveFlags.IS_REACTIVE){\r\n                return true;\r\n            }\r\n            console.log(target);\r\n            track(target,'get',key);\r\n            // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u53D6\u503C\u4E86\r\n            console.log(receiver);\r\n            \r\n            return Reflect.get(target, key ,receiver);\r\n        },\r\n        set(target, key,value ,receiver){\r\n            let oldvalue = target[key];\r\n            let rusult =Reflect.set(target, key ,value,receiver);\r\n            if(oldvalue !== value){\r\n                trigger(target,'set',key,value,oldvalue)\r\n\r\n            }\r\n            // \u8FD9\u91CC\u53EF\u4EE5\u76D1\u63A7\u5230\u7528\u6237\u8BBE\u7F6E\u503C\u4E86\r\n            return rusult;\r\n        }\r\n    }", "import { isObject } from \"@vue/shared\";\r\nimport {mutableHandler,ReactiveFlags} from './baseHandler'\r\n// \u5C06\u6570\u636E\u8F6C\u5316\u4E3A\u54CD\u5E94\u5F0F\u7684\u6570\u636E\uFF0C\u53EA\u80FD\u505A\u6570\u636E\u7684\u4EE3\u7406\r\n//\u907F\u514D\u91CD\u590D\u4EE3\u7406\r\nconst reactiveMap= new WeakMap(); // key\u53EA\u80FD\u662F\u5BF9\u8C61\r\n\r\nexport function reactive(target){\r\n    if(!isObject(target)){\r\n        return\r\n    }\r\n    let existingProxy = reactiveMap.get(target);\r\n    if(existingProxy){\r\n        return existingProxy;\r\n    }\r\n    //  \u7B2C\u4E00\u6B21\u666E\u901A\u5BF9\u8C61\u4EE3\u7406 \u4F1A\u901A\u8FC7new proxy \u4EE3\u7406\u4E00\u6B21\r\n    // \u4E0B\u4E00\u6B21\u4F20\u9012\u7684\u662Fproxy\u662F\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u4E0B\u5B83\u53C8\u6CA1\u6709\u4EE3\u7406\u8FC7\uFF0C\u5982\u679C\u8BBF\u95EE\u8FD9\u4E2Aproxy\r\n    // \u6709get\u65B9\u6CD5\uFF0C\u8BF4\u660E\u4EE3\u7406\u8FC7\u4E86\r\n    if(target[ReactiveFlags.IS_REACTIVE]){\r\n        return target;\r\n    }\r\n    const proxy =  new Proxy(target,mutableHandler)\r\n    reactiveMap.set(target,proxy)\r\n    return proxy;\r\n\r\n}\r\n// let target = {\r\n//     _name:'zf',\r\n//     get name(){\r\n//         return this._name //\u4F7F\u7528reflect this\u4F1A\u53D8\u4E3A\u4EE3\u7406\uFF0C\u53EF\u4EE5\u76D1\u542C_name. \u5426\u5219this \u4E3Atarget\r\n//     }\r\n// }\r\n// const proxy =  new Proxy(target,{\r\n//     get(target, key ,receiver){\r\n//         // return target[key] ;//\u8FD9\u6837\u4E0D\u4F1A\u76D1\u542C\u5230_name\r\n//         return Reflect.get(target, key ,receiver); //receiver\u6539\u53D8\u4E86 this\u7684\u6307\u5411\r\n//     },\r\n//     set(target, key,value ,receiver){\r\n//         // target[key] = value;\r\n//         // return true;\r\n//         return Reflect.set(target, key ,receiver)\r\n//     }\r\n// })\r\n// console.log(proxy.name);\r\n\r\n\r\n"],
  "mappings": "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",
  "names": []
}
